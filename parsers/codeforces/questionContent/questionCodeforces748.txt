H2. Game of AI (hard version)
time limit per test12 seconds
memory limit per test1024 megabytes
inputstandard input
outputstandard output
This is the hard version of this problem. The difference between easy and hard versions is the constraint on
k
and the time limit. Notice that you need to calculate the answer for all positive integers
n∈[1,k]
in this version. You can make hacks only if both versions of the problem are solved.
Cirno is playing a war simulator game with
n
towers (numbered from
1
to
n
) and
n
bots (numbered from
1
to
n
). The
i
-th tower is initially occupied by the
i
-th bot for
1≤i≤n
.
Before the game, Cirno first chooses a permutation
p=[
p
1
,
p
2
,…,
p
n
]
of length
n
(A permutation of length
n
is an array of length
n
where each integer between
1
and
n
appears exactly once). After that, she can choose a sequence
a=[
a
1
,
a
2
,…,
a
n
]
(
1≤
a
i
≤n
and
a
i
≠i
for all
1≤i≤n
).
The game has
n
rounds of attacks. In the
i
-th round, if the
p
i
-th bot is still in the game, it will begin its attack, and as the result the
a
p
i
-th tower becomes occupied by the
p
i
-th bot; the bot that previously occupied the
a
p
i
-th tower will no longer occupy it. If the
p
i
-th bot is not in the game, nothing will happen in this round.
After each round, if a bot doesn't occupy any towers, it will be eliminated and leave the game. Please note that no tower can be occupied by more than one bot, but one bot can occupy more than one tower during the game.
At the end of the game, Cirno will record the result as a sequence
b=[
b
1
,
b
2
,…,
b
n
]
, where
b
i
is the number of the bot that occupies the
i
-th tower at the end of the game.
However, as a mathematics master, she wants you to solve the following counting problem instead of playing games:
Count the number of different pairs of sequences
a
,
b
from all possible choices of sequence
a
and permutation
p
.
Calculate the answers for all
n
such that
1≤n≤k
. Since these numbers may be large, output them modulo
M
.
Input
The only line contains two positive integers
k
and
M
(
1≤k≤
10
5
,
2≤M≤
10
9
). It is guaranteed that
2
18
is a divisor of
M−1
and
M
is a prime number.
Output
Output
k
lines, where the
i
-th line contains a non-negative integer, which is the answer for
n=i
modulo
M
.
Example
input
Copy
8 998244353
output
Copy
0
2
24
360
6800
153150
4057452
123391016
Note
For
n=1
, no valid sequence
a
exists. We regard the answer as
0
.
For
n=2
, there is only one possible array
a
:
[2,1]
.
For array
a
is
[2,1]
and permutation
p
is
[1,2]
, the sequence
b
will be
[1,1]
after all rounds have finished. The details for each rounds:
In the first round, the first bot will begin its attack and successfully capture the tower
2
. After this round, the second bot will be eliminated and leave the game as all of its towers are occupied by other bots.
In the second round, the second bot is not in the game.
For array
a
is
[2,1]
and permutation
p
is
[2,1]
, the sequence
b
will be
[2,2]
after all rounds have finished. The details for each rounds:
In the first round, the second bot will begin its attack and successfully capture the tower
1
. After this round, the first bot will be eliminated and leave the game as all of its towers are occupied by other bots.
In the second round, the first bot is not in the game.
So the number of different pairs of sequences
(a,b)
is
2
(
[2,1]
,
[1,1]
and
[2,1]
,
[2,2]
) for
n=2
.