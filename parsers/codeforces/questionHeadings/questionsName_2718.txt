E2. Three Blocks Palindrome (hard version)