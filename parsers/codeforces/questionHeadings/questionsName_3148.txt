D2. Too Many Segments (hard version)