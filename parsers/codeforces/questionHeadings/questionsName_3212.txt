B2. Social Network (hard version)