D2. Kirk and a Binary String (hard version)