D2. Balance (Hard version)